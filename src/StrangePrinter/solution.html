<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Strange Printer - Solution</title>
</head>
<body>
<h2 id="solution">Strange Printer - Solution</h2>
<hr>
<h3 id="overview">Overview</h3>
<blockquote>
    <p><strong>Note.</strong> For this problem, we assume that you already know the fundamentals of dynamic programming
        and are figuring out how to apply it to a wide range of problems, such as this one. If you are not yet at this
        stage, we recommend checking out our relevant <a
                href="https://leetcode.com/explore/featured/card/dynamic-programming/" target="_blank">Explore Card
            content on dynamic programming</a> before coming back to this article.</p>
</blockquote>
<p>In this article, we will denote the <span class="math math-inline"><span class="katex"><span class="katex-mathml">ithi^\text{th}</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.8491em;"></span><span
        class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t"><span
        class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span
        style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span
        class="mord mtight">th</span></span></span></span></span></span></span></span></span></span></span></span></span>
    character of the string <span class="math math-inline"><span class="katex"><span class="katex-mathml">ss</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span></span></span></span></span> as <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">sis_i</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span
            class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>,
    and the substring from the <span class="math math-inline"><span class="katex"><span class="katex-mathml">lthl^\text{th}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8491em;"></span><span
            class="mord"><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span
            class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                                                                              style="height: 0.8491em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span
            class="mord mtight">th</span></span></span></span></span></span></span></span></span></span></span></span></span>
    to the <span class="math math-inline"><span class="katex"><span class="katex-mathml">rthr^\text{th}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8491em;"></span><span
            class="mord"><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
            class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                                                                              style="height: 0.8491em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span
            class="mord mtight">th</span></span></span></span></span></span></span></span></span></span></span></span></span>
    character (inclusive) as <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">sl..rs_{l..r}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">r</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
</p>
<blockquote>
    <p>Let <span class="math math-inline"><span class="katex"><span class="katex-mathml">s=s = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>leetcode</code>. Then <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">s4=s_4 = </span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>c</code>, <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">s7=s_7 = </span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>e</code>, <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">s4..7=s_{4..7} = </span><span class="katex-html"
                                                                                   aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
            class="mord mtight">4..7</span></span></span></span></span><span class="vlist-s">​</span></span><span
            class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>code</code>.</p>
</blockquote>
<p>One can represent each strange printer operation with a triplet <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace"
                                                                                                       style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span> meaning that it prints the character <span
        class="math math-inline"><span class="katex"><span class="katex-mathml">cc</span><span class="katex-html"
                                                                                               aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></span>
    over the substring <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">sl..rs_{l..r}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">r</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
</p>
<p>Consider two examples.</p>
<ul>
    <li>When one needs to print <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">s=s = </span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace"
                                                                                                       style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>aba</code>, the first step is to print
        <code>aaa</code> (<span class="math math-inline"><span class="katex"><span class="katex-mathml">33</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6444em;"></span><span
                class="mord">3</span></span></span></span></span> occurrences of <code>a</code>) and then transform it
        into <code>aba</code> in one operation.
    </li>
    <li>To print <code>leetcode</code>, we first print <code>eeeeeeee</code> (<span class="math math-inline"><span
            class="katex"><span class="katex-mathml">88</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">8</span></span></span></span></span>
        occurrences of <code>e</code>) and then transform it into <code>leetcode</code>: <code>eeeeeeee</code> <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">→\to</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.3669em;"></span><span
                class="mrel">→</span></span></span></span></span> <code>leeeeeee</code> <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">→\to</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.3669em;"></span><span
                class="mrel">→</span></span></span></span></span> <code>leeteeee</code> <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">→\to</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.3669em;"></span><span
                class="mrel">→</span></span></span></span></span> <code>leetceee</code> <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">→\to</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.3669em;"></span><span
                class="mrel">→</span></span></span></span></span> <code>leetcoee</code> <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">→\to</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.3669em;"></span><span
                class="mrel">→</span></span></span></span></span> <code>leetcode</code>.
    </li>
</ul>
<p>Take a closer look at the sequences of operations in these two examples. For all operations <span
        class="math math-inline"><span class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace"
                                                                                                       style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">c=src = s_r</span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
        class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span
        class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span
        class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span
        class="vlist" style="height: 0.1514em;"><span
        style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                            style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                      style="margin-right: 0.02778em;">r</span></span></span></span><span
        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                   style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    holds.</p>
<p>In the first example, we have <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">s=s = </span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
        class="mrel">=</span></span></span></span></span><code>aba</code> and the operations:</p>
<ol>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>a</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,0,2), 0, 2)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">0</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">2</span><span class="mclose">)</span></span></span></span></span> prints the character
        <code>a</code> over the entire string <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">ss</span><span class="katex-html" aria-hidden="true"><span class="base"><span
                class="strut" style="height: 0.4306em;"></span><span
                class="mord mathnormal">s</span></span></span></span></span>. Here we have <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">c=c = </span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.4306em;"></span><span
                class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span></span></span></span></span><code>a</code>, <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">l=0l = 0</span><span class="katex-html"
                                                                              aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal"
                                                                                        style="margin-right: 0.01968em;">l</span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace"
                                                                                                       style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">0</span></span></span></span></span>, <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">r=2r = 2</span><span class="katex-html"
                                                                              aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal"
                                                                                        style="margin-right: 0.02778em;">r</span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace"
                                                                                                       style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">2</span></span></span></span></span>. The character <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">c=c = </span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">c</span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span></span></span></span></span><code>a</code> equals <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">sr=s2=s_r = s_2 = </span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                              style="margin-right: 0.02778em;">r</span></span></span></span><span
                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace"
                                                                                                       style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span
                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span></span></span></span></span><code>a</code>.
    </li>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>b</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,1,1), 1, 1)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">1</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">1</span><span class="mclose">)</span></span></span></span></span> prints <code>b</code> at the
        index <span class="math math-inline"><span class="katex"><span class="katex-mathml">11</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6444em;"></span><span
                class="mord">1</span></span></span></span></span> (the range of this operation contains only one
        position). Again, <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">c=c = </span><span class="katex-html" aria-hidden="true"><span class="base"><span
                class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">c</span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span></span></span></span></span><code>b</code> equals <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">s1s_1</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span
                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
        = <code>b</code>.
    </li>
</ol>
<p>In the second example, <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">s=s = </span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">s</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
        class="mrel">=</span></span></span></span></span><code>leetcode</code>. The operations are:</p>
<ol>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>e</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,0,7), 0, 7)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">0</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">7</span><span class="mclose">)</span></span></span></span></span> prints the character <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">c=s7=c = s_7 = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>e</code> over the entire string <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">ss</span><span class="katex-html"
                                                                                                   aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span></span></span></span></span>.
    </li>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>l</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,0,0), 0, 0)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">0</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">0</span><span class="mclose">)</span></span></span></span></span> prints <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">c=s0=c = s_0 = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>l</code> at the index <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">00</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>.
    </li>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>t</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,3,3), 3, 3)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">3</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">3</span><span class="mclose">)</span></span></span></span></span> prints <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">c=s3=c = s_3 = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>t</code> at the index <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">33</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">3</span></span></span></span></span>.
    </li>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>c</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,4,4), 4, 4)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">4</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">4</span><span class="mclose">)</span></span></span></span></span> prints <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">c=s4=c = s_4 = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>c</code> at the index <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">44</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">4</span></span></span></span></span>.
    </li>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>o</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,5,5), 5, 5)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">5</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">5</span><span class="mclose">)</span></span></span></span></span> prints <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">c=s5=c = s_5 = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>o</code> at the index <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">55</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">5</span></span></span></span></span>.
    </li>
    <li><span class="math math-inline"><span class="katex"><span class="katex-mathml">((</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span></span></span></span></span><code>d</code><span class="math math-inline"><span
            class="katex"><span class="katex-mathml">,6,6), 6, 6)</span><span class="katex-html"
                                                                              aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord">6</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">6</span><span class="mclose">)</span></span></span></span></span> prints <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">c=s6=c = s_6 = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>d</code> at the index <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">66</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">6</span></span></span></span></span>.
    </li>
</ol>
<p>Now, we want to prove the following lemma.</p>
<p><strong>Lemma.</strong> There exists at least one optimal sequence, where for each operation <span
        class="math math-inline"><span class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace"
                                                                                                       style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">c=src = s_r</span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
        class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span
        class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span
        class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span
        class="vlist" style="height: 0.1514em;"><span
        style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                            style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                      style="margin-right: 0.02778em;">r</span></span></span></span><span
        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                   style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    holds.</p>
<p><em>Proof</em>. Consider an optimal answer (with the minimum number of operations) not satisfying the condition, i.e.
    containing a "bad" operation <span class="math math-inline"><span class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span>
    with <span class="math math-inline"><span class="katex"><span class="katex-mathml">c≠src \ne s_r</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span
            class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="inner"><span
            class="mord"><span class="mrel"></span></span></span><span
            class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
    Immediately after this operation, the character at the <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">rthr^\text{th}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span
            class="mord mtight">th</span></span></span></span></span></span></span></span></span></span></span></span></span>
    position is <span class="math math-inline"><span class="katex"><span class="katex-mathml">cc</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span></span></span></span></span>, but in the end, it must be <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">srs_r</span><span class="katex-html"
                                                                                                      aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>,
    meaning that printing <span class="math math-inline"><span class="katex"><span class="katex-mathml">cc</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span></span></span></span></span> at the <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">rthr^\text{th}</span><span class="katex-html"
                                                                                aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span
            class="mord mtight">th</span></span></span></span></span></span></span></span></span></span></span></span></span>
    position was useless. Thus one can safely replace the operation <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span>
    with <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">(c,l,r−1)(c, l, r - 1)</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord">1</span><span class="mclose">)</span></span></span></span></span>. Note, that <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">(c,l,r−1)(c, l, r - 1)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord">1</span><span class="mclose">)</span></span></span></span></span> might still be "bad", i.e.
    satisfying <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">c≠sr−1c \ne s_{r - 1}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span
            class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="inner"><span
            class="mord"><span class="mrel"></span></span></span><span
            class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6389em; vertical-align: -0.2083em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.02778em;">r</span><span
            class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span></span></span>.
</p>
<p>One can replace "bad" operations <span class="math math-inline"><span class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace"
                                                                                                       style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span> with <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">(c,l,r−1)(c, l, r - 1)</span><span class="katex-html"
                                                                                    aria-hidden="true"><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace"
                                                                                                       style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace"
                                                                                               style="margin-right: 0.2222em;"></span></span><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord">1</span><span class="mclose">)</span></span></span></span></span> iteratively until there are no
    more "bad" operations in the sequence. At the end of this iterative process, each triplet <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">(c,l,r)(c, l, r)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span>
    will satisfy <span class="math math-inline"><span class="katex"><span class="katex-mathml">c=src = s_r</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
    Since the new sequence remains optimal (the number of operations did not increase), we have proved the lemma.</p>
<p>We will seek a solution to the problem among the sequences satisfying the condition in the lemma.</p>
<hr>
<h3 id="approach-1-bottom-up-dynamic-programming">Approach 1: Bottom-Up Dynamic Programming</h3>
<h4 id="intuition">Intuition</h4>
<p>To solve the problem, we break it down into smaller subproblems. One way to do this is to consider all possible
    substrings of the input string and find the minimum number of operations required to print each substring using the
    strange printer.</p>
<p>Given a pair of indices <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">(l,r)(l, r)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span>, consider a string <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">tt</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span>
    of length <span class="math math-inline"><span class="katex"><span class="katex-mathml">r−l+1r - l + 1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>
    that only has the character <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">srs_r</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span
            class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
            class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
</p>
<p>Let <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[l][r]\text{dp}[l][r]</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord mathnormal"
                                                                                               style="margin-right: 0.01968em;">l</span><span
        class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal"
                                                                 style="margin-right: 0.02778em;">r</span><span
        class="mclose">]</span></span></span></span></span> be the minimum number of operations needed to transform
    <span class="math math-inline"><span class="katex"><span class="katex-mathml">tt</span><span class="katex-html"
                                                                                                 aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6151em;"></span><span
            class="mord mathnormal">t</span></span></span></span></span> into the substring <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">sl..rs_{l..r}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">r</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
    Notice how this <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp\text{dp}</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord text"><span
            class="mord">dp</span></span></span></span></span></span> definition is based on choosing to print on the
    indices <span class="math math-inline"><span class="katex"><span class="katex-mathml">[l,r][l, r]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">]</span></span></span></span></span>,
    and then figuring out how many operations will be needed after.</p>
<blockquote>
    <p>For example, let <span class="math math-inline"><span class="katex"><span class="katex-mathml">s=s = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>leetcode</code>.</p>
    <ul>
        <li><span class="math math-inline"><span class="katex"><span
                class="katex-mathml">dp[1][5]=3\text{dp}[1][5] = 3</span><span class="katex-html"
                                                                               aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span
                class="mord">5</span><span class="mclose">]</span><span class="mspace"
                                                                        style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">3</span></span></span></span></span> is the number of operations to transform
            <code>ooooo</code> into <code>eetco</code>.
        </li>
        <li><span class="math math-inline"><span class="katex"><span
                class="katex-mathml">dp[4][7]=3\text{dp}[4][7] = 3</span><span class="katex-html"
                                                                               aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord">4</span><span class="mclose">]</span><span class="mopen">[</span><span
                class="mord">7</span><span class="mclose">]</span><span class="mspace"
                                                                        style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">3</span></span></span></span></span> is the answer for transforming <code>eeee</code> into
            <code>code</code>.
        </li>
    </ul>
</blockquote>
<p>The base cases of this DP are the substrings entirely consisting of the same character. For such of these substrings,
    <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp[l][r]=0\text{dp}[l][r] = 0</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
            class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>,
    since one does not have to do any operations.</p>
<blockquote>
    <p>For example, for <span class="math math-inline"><span class="katex"><span class="katex-mathml">s=s = </span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span></span></span></span></span><code>leetcode</code>, <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">dp[1][2]=0\text{dp}[1][2] = 0</span><span class="katex-html"
                                                                                               aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord">1</span><span
            class="mclose">]</span><span class="mopen">[</span><span class="mord">2</span><span
            class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>,
        because transforming <code>ee</code> into <code>ee</code> requires <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">00</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">0</span></span></span></span></span> operations.</p>
</blockquote>
<p>Now we need to write down the transitions for this DP.</p>
<p>Consider a substring <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">sl..rs_{l..r}</span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span
        class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span
        class="vlist" style="height: 0.3361em;"><span
        style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                            style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                style="margin-right: 0.01968em;">l</span><span
        class="mord mtight">..</span><span class="mord mathnormal mtight"
                                           style="margin-right: 0.02778em;">r</span></span></span></span></span><span
        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                   style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    containing at least two distinct characters. Let <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">jj</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span class="mord mathnormal"
                                                                                           style="margin-right: 0.05724em;">j</span></span></span></span></span>
    be the leftmost index such that <span class="math math-inline"><span class="katex"><span class="katex-mathml">j≥lj \ge l</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.854em; vertical-align: -0.1944em;"></span><span
            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">≥</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal"
                                                                                    style="margin-right: 0.01968em;">l</span></span></span></span></span>
    and <span class="math math-inline"><span class="katex"><span class="katex-mathml">sj≠srs_j \ne s_r</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.9805em; vertical-align: -0.2861em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.05724em;">j</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.2861em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span class="mrel"><span
            class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut"
                                                                             style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="inner"><span class="mord"><span class="mrel"></span></span></span><span
            class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    (the first character in the range that doesn't equal the last character in the range).</p>
<p>We want to transform the string of <span class="math math-inline"><span class="katex"><span class="katex-mathml">r−l+1r - l + 1</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
        class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                               style="margin-right: 0.2222em;"></span><span
        class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span class="mord mathnormal"
                                                                                        style="margin-right: 0.01968em;">l</span><span
        class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace"
                                                                                               style="margin-right: 0.2222em;"></span></span><span
        class="base"><span class="strut" style="height: 0.6444em;"></span><span
        class="mord">1</span></span></span></span></span> occurrences of <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">srs_r</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
        class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
        class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
        style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                            style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                      style="margin-right: 0.02778em;">r</span></span></span></span><span
        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                   style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    into <span class="math math-inline"><span class="katex"><span class="katex-mathml">sl..rs_{l..r}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">r</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
    Since <span class="math math-inline"><span class="katex"><span class="katex-mathml">sj≠srs_j \ne s_r</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.9805em; vertical-align: -0.2861em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.05724em;">j</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.2861em;"><span></span></span></span></span></span></span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span class="mrel"><span
            class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut"
                                                                             style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="inner"><span class="mord"><span class="mrel"></span></span></span><span
            class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>,
    we will eventually have to change the character at the <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">jthj^\text{th}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1.0435em; vertical-align: -0.1944em;"></span><span
            class="mord"><span class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span
            class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"
                                                                              style="height: 0.8491em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span
            class="mord mtight">th</span></span></span></span></span></span></span></span></span></span></span></span></span>
    position by printing another character over it. The characters in the substring <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">sl..j−1s_{l..j - 1}</span><span class="katex-html"
                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight"
                                               style="margin-right: 0.05724em;">j</span><span
            class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.2861em;"><span></span></span></span></span></span></span></span></span></span></span>
    are all equal to <span class="math math-inline"><span class="katex"><span class="katex-mathml">srs_r</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                          style="margin-right: 0.02778em;">r</span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    (based on how we defined <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">jj</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span class="mord mathnormal"
                                                                                           style="margin-right: 0.05724em;">j</span></span></span></span></span>),
    so we will not worry about them anymore for the rest of the algorithm. Now, we focus on the range <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">[j,r][j, r]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">]</span></span></span></span></span>.
</p>
<p>Consider the first operation that prints at the position <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">jj</span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                                           style="height: 0.854em; vertical-align: -0.1944em;"></span><span
        class="mord mathnormal" style="margin-right: 0.05724em;">j</span></span></span></span></span>. We know that we
    start printing at position <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">jj</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span class="mord mathnormal"
                                                                                           style="margin-right: 0.05724em;">j</span></span></span></span></span>,
    but we do not know where we end. Let's call the ending position <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">ii</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6595em;"></span><span
            class="mord mathnormal">i</span></span></span></span></span> so that the operation is <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">(si,j,i)(s_i, j, i)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span
            class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">i</span><span
            class="mclose">)</span></span></span></span></span>.</p>
<p>Let's see what happens for a fixed <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">ii</span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                                           style="height: 0.6595em;"></span><span
        class="mord mathnormal">i</span></span></span></span></span>.</p>
<ul>
    <li>With the operation <span class="math math-inline"><span class="katex"><span class="katex-mathml">(si,j,i)(s_i, j, i)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span
            class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">i</span><span
            class="mclose">)</span></span></span></span></span> we print the character <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">sis_i</span><span class="katex-html"
                                                                                                      aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span
            class="vlist-r"><span class="vlist" style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
        over the substring <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">sj..is_{j..i}</span><span class="katex-html" aria-hidden="true"><span class="base"><span
                class="strut" style="height: 0.7167em; vertical-align: -0.2861em;"></span><span class="mord"><span
                class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                        style="margin-right: 0.05724em;">j</span><span
                class="mord mtight">..</span><span
                class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span
                class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span></span></span></span></span></span></span></span></span></span></span>.
        After that, the problem reduces to two independent smaller problems.
    </li>
    <li>Now the segment <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">sj..is_{j..i}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.05724em;">j</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.2861em;"><span></span></span></span></span></span></span></span></span></span></span>
        contains <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">j−i+1j - i + 1</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                       style="margin-right: 0.2222em;"></span><span
                class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 0.7429em; vertical-align: -0.0833em;"></span><span
                class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">1</span></span></span></span></span> occurrences of <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">sis_i</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span
                class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span
                class="vlist-r"><span class="vlist"
                                      style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
        By definition of DP, it takes <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[j][i]\text{dp}[j][i]</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span><span
                class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span></span>
        operations to "fix" this segment.
    </li>
    <li>The segment <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">si+1..rs_{i + 1..r}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6389em; vertical-align: -0.2083em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
            class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span
            class="mord mtight">1..</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">r</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.2083em;"><span></span></span></span></span></span></span></span></span></span></span>
        contains <span class="math math-inline"><span class="katex"><span class="katex-mathml">r−ir - i</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
                class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                       style="margin-right: 0.2222em;"></span><span
                class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span>
        occurrences of <span class="math math-inline"><span class="katex"><span class="katex-mathml">srs_r</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                              style="margin-right: 0.02778em;">r</span></span></span></span><span
                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
        (remember that originally, we have <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">[l,r][l, r]</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span
                class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
                class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
                class="mclose">]</span></span></span></span></span> all equal to <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">srs_r</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight"
                                                              style="margin-right: 0.02778em;">r</span></span></span></span><span
                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>,
        and we didn't override the range <span class="math math-inline"><span class="katex"><span class="katex-mathml">[i+1,r][i + 1, r]</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace"
                                                                                  style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord">1</span><span class="mpunct">,</span><span class="mspace"
                                                                        style="margin-right: 0.1667em;"></span><span
                class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
                class="mclose">]</span></span></span></span></span> with the operation <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">(si,j,i)(s_i, j, i)</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span
                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                                                           style="height: 0.3117em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span
                class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span
                class="vlist-r"><span class="vlist"
                                      style="height: 0.15em;"><span></span></span></span></span></span></span><span
                class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
                class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mpunct">,</span><span
                class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">i</span><span
                class="mclose">)</span></span></span></span></span>). Similarly, it takes <span
                class="math math-inline"><span class="katex"><span
                class="katex-mathml">dp[i+1][r]\text{dp}[i + 1][r]</span><span class="katex-html"
                                                                               aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span
                class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
                class="mclose">]</span></span></span></span></span> operations to "fix" it.
    </li>
</ul>
<p>For a fixed <span class="math math-inline"><span class="katex"><span class="katex-mathml">ii</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.6595em;"></span><span
        class="mord mathnormal">i</span></span></span></span></span>, the answer is <span class="math math-inline"><span
        class="katex"><span
        class="katex-mathml">1+dp[j][i]+dp[i+1][r]1 + \text{dp}[j][i] + \text{dp}[i + 1][r]</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
        class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span
        class="mord">dp</span></span><span class="mopen">[</span><span class="mord mathnormal"
                                                                       style="margin-right: 0.05724em;">j</span><span
        class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span
        class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span
        class="mord">dp</span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span
        class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace"
                                                                                               style="margin-right: 0.2222em;"></span></span><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal"
                                                                                            style="margin-right: 0.02778em;">r</span><span
        class="mclose">]</span></span></span></span></span>. To find <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">dp[l][r]\text{dp}[l][r]</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord mathnormal"
                                                                                               style="margin-right: 0.01968em;">l</span><span
        class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal"
                                                                 style="margin-right: 0.02778em;">r</span><span
        class="mclose">]</span></span></span></span></span>, we first find <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">jj</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span
        class="mord mathnormal" style="margin-right: 0.05724em;">j</span></span></span></span></span> according to how
    we defined it above, then we try all possible <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">j≤i&lt;rj \le i &lt; r</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span
            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">≤</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6986em; vertical-align: -0.0391em;"></span><span
            class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal"
                                                                                    style="margin-right: 0.02778em;">r</span></span></span></span></span>
    and take the minimum value from the recurrence just defined.</p>
<blockquote>
    <p>The animation shows the computation of <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp[0][10]\text{dp}[0][10]</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord">0</span><span
            class="mclose">]</span><span class="mopen">[</span><span class="mord">10</span><span class="mclose">]</span></span></span></span></span>
        for <span class="math math-inline"><span class="katex"><span class="katex-mathml">s=s = </span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.4306em;"></span><span
                class="mord mathnormal">s</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span></span></span></span></span><code>aabcbddcbba</code>. Here we have <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">j=2j = 2</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                       style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">2</span></span></span></span></span>, because <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">s2≠s10s_2 \ne s_{10}</span><span class="katex-html"
                                                                                          aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span
                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span><span
                class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span class="mrel"><span
                class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut"
                                                                                 style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                class="inner"><span class="mord"><span class="mrel"></span></span></span><span
                class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"
                                                                                                       style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
                class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span
                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                    style="height: 2.7em;"></span><span
                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span
                class="vlist-r"><span class="vlist"
                                      style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.
        To find <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">dp[0][10]\text{dp}[0][10]</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord">0</span><span class="mclose">]</span><span class="mopen">[</span><span
                class="mord">10</span><span class="mclose">]</span></span></span></span></span>, one calculates <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">1+dp[2][i]+dp[i+1][10]1 + \text{dp}[2][i] + \text{dp}[i + 1][10]</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord">2</span><span class="mclose">]</span><span class="mopen">[</span><span
                class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span
                class="mord">10</span><span class="mclose">]</span></span></span></span></span> for all <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">ii</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6595em;"></span><span
                class="mord mathnormal">i</span></span></span></span></span> between <span
                class="math math-inline"><span class="katex"><span class="katex-mathml">22</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6444em;"></span><span
                class="mord">2</span></span></span></span></span> and <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">99</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">9</span></span></span></span></span>. The range <span class="math math-inline"><span
                class="katex"><span class="katex-mathml">[2,i][2, i]</span><span class="katex-html"
                                                                                 aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace"
                                                                                                    style="margin-right: 0.1667em;"></span><span
                class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span></span> is in green,
        and <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">[i+1,10][i + 1, 10]</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace"
                                                                                  style="margin-right: 0.2222em;"></span><span
                class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                class="mord">1</span><span class="mpunct">,</span><span class="mspace"
                                                                        style="margin-right: 0.1667em;"></span><span
                class="mord">10</span><span class="mclose">]</span></span></span></span></span> is in yellow. We assume
        that we have found the values of DP for smaller substrings earlier (we do not show the computation of them).</p>
</blockquote>
<p>
<div class="relative mx-auto mb-6 flex flex-col overflow-hidden rounded-lg border-[1px] border-label-1"
     style="max-width: 960px;">
    <div class="rounded-lg" style="max-height: 540px;"><img alt="Current"
                                                            class="object-fit-contain !mb-0 max-h-full max-w-full"
                                                            src="blob:https://leetcode.com/cfe21fac-a83d-43c7-a04d-79112052f124">
    </div>
    <div class="absolute top-[50%] left-[50%] flex h-12 w-12 translate-x-[-50%] translate-y-[-50%] items-center justify-center rounded-full bg-black/30">
        <div class="flex h-4 w-4 cursor-pointer items-center justify-center text-[35px]">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em" fill="currentColor"
                 class="h-full w-full text-white">
                <path fill-rule="evenodd"
                      d="M18.97 12.871l-12.96 7.29a1 1 0 01-1.49-.87V4.71a1 1 0 011.49-.872l12.96 7.29a1 1 0 010 1.743z"
                      clip-rule="evenodd"></path>
            </svg>
        </div>
    </div>
    <div class="relative flex h-8 select-none items-center justify-around bg-black">
        <div class="flex items-center space-x-7">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em" fill="currentColor"
                 class="w-4 cursor-pointer text-gray-6 dark:text-dark-gray-6 hover:text-gray-7 dark:hover:text-dark-gray-7">
                <path fill-rule="evenodd"
                      d="M16.091 4.929l-7.057 7.078 7.057 7.064a1 1 0 01-1.414 1.414l-7.764-7.77a1 1 0 010-1.415l7.764-7.785a1 1 0 111.415 1.414z"
                      clip-rule="evenodd"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em" fill="currentColor"
                 class="w-4 cursor-pointer text-gray-6 dark:text-dark-gray-6 hover:text-gray-7 dark:hover:text-dark-gray-7">
                <path fill-rule="evenodd"
                      d="M18.97 12.871l-12.96 7.29a1 1 0 01-1.49-.87V4.71a1 1 0 011.49-.872l12.96 7.29a1 1 0 010 1.743z"
                      clip-rule="evenodd"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em" fill="currentColor"
                 class="w-4 cursor-pointer text-gray-6 dark:text-dark-gray-6 hover:text-gray-7 dark:hover:text-dark-gray-7">
                <path fill-rule="evenodd"
                      d="M7.913 19.071l7.057-7.078-7.057-7.064a1 1 0 011.414-1.414l7.764 7.77a1 1 0 010 1.415l-7.764 7.785a1 1 0 01-1.414-1.414z"
                      clip-rule="evenodd"></path>
            </svg>
        </div>
        <div class="absolute right-0 mr-5 text-xs font-medium text-white">1 / 18</div>
    </div>
</div>
<br>
<br></p>
<p>The length of the substring <span class="math math-inline"><span class="katex"><span class="katex-mathml">sl..rs_{l..r}</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.5806em; vertical-align: -0.15em;"></span><span
        class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span
        class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
        style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                            style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                style="margin-right: 0.01968em;">l</span><span
        class="mord mtight">..</span><span class="mord mathnormal mtight"
                                           style="margin-right: 0.02778em;">r</span></span></span></span></span><span
        class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                   style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    is <span class="math math-inline"><span class="katex"><span class="katex-mathml">r−l+1r - l + 1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>,
    we will denote it <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">length\text{length}</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">length</span></span></span></span></span></span>. Since <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">length=r−l+1\text{length} = r - l + 1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">length</span></span><span class="mspace"
                                                                           style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>,
    thus <span class="math math-inline"><span class="katex"><span class="katex-mathml">r=l+length−1r = l + \text{length} - 1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mspace"
                                                                                   style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">length</span></span><span class="mspace"
                                                                           style="margin-right: 0.2222em;"></span><span
            class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>.
</p>
<p>Since we calculate the value of <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp\text{dp}</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
        class="mord text"><span class="mord">dp</span></span></span></span></span></span> for larger substrings via the
    smaller ones, we need to compute <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp\text{dp}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">dp</span></span></span></span></span></span> for strings in ascending
    order of their length: first consider the substrings having <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">length=1\text{length} = 1</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">length</span></span><span class="mspace"
                                                                           style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>,
    then <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">length=2\text{length} = 2</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">length</span></span><span class="mspace"
                                                                           style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">2</span></span></span></span></span>,
    etc.</p>
<p>Now we need to find the answer to the problem using DP.</p>
<p>Let <span class="math math-inline"><span class="katex"><span class="katex-mathml">nn</span><span class="katex-html"
                                                                                                    aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>
    be the size of <span class="math math-inline"><span class="katex"><span class="katex-mathml">ss</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span></span></span></span></span>.</p>
<p>Our first operation should always be to print the final character of <code>s</code> <span
        class="math math-inline"><span class="katex"><span class="katex-mathml">nn</span><span class="katex-html"
                                                                                               aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>
    times. Then, we transform this string into <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">ss</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span></span></span></span></span> in <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">dp[0][n−1]\text{dp}[0][n - 1]</span><span class="katex-html"
                                                                                               aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord">0</span><span
            class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span
            class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace"
                                                                                                   style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord">1</span><span class="mclose">]</span></span></span></span></span> operations. We need to start
    with this print operation because of the lemma we proved before; it is the only way we can get the last character
    printed optimally.</p>
<p>The answer to the problem is <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[0][n−1]+1\text{dp}[0][n - 1] + 1</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
        class="mord">0</span><span class="mclose">]</span><span class="mopen">[</span><span
        class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span
        class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>. The
    <span class="math math-inline"><span class="katex"><span class="katex-mathml">+1+ 1</span><span class="katex-html"
                                                                                                    aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">+</span><span class="mord">1</span></span></span></span></span> is due to the first print
    operation which is not considered in the DP.</p>
<h4 id="algorithm">Algorithm</h4>
<blockquote>
    <p>In the code, we use <code>left</code> for <code>l</code> and <code>right</code> for <code>r</code> for clarity.
    </p>
</blockquote>
<ol>
    <li>Let <span class="math math-inline"><span class="katex"><span class="katex-mathml">nn</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.4306em;"></span><span
            class="mord mathnormal">n</span></span></span></span></span> be the size of <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">ss</span><span class="katex-html"
                                                                                                   aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.4306em;"></span><span
            class="mord mathnormal">s</span></span></span></span></span>.
    </li>
    <li>Declare the 2D array <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp\text{dp}</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord text"><span
            class="mord">dp</span></span></span></span></span></span> of size <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">n×nn \times n</span><span class="katex-html"
                                                                               aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
            class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
            class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.4306em;"></span><span
            class="mord mathnormal">n</span></span></span></span></span>. Since we want to find a minimum, we will
        initialize it with values of <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">nn</span><span class="katex-html" aria-hidden="true"><span class="base"><span
                class="strut" style="height: 0.4306em;"></span><span
                class="mord mathnormal">n</span></span></span></span></span> (a value large enough that it's guaranteed
        to not be smaller than the answer).
    </li>
    <li>Iterate <span class="math math-inline"><span class="katex"><span class="katex-mathml">length\text{length}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">length</span></span></span></span></span></span> (the length of the
        current print) from <span class="math math-inline"><span class="katex"><span class="katex-mathml">11</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6444em;"></span><span
                class="mord">1</span></span></span></span></span> to <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">nn</span><span class="katex-html" aria-hidden="true"><span class="base"><span
                class="strut" style="height: 0.4306em;"></span><span
                class="mord mathnormal">n</span></span></span></span></span>.
        <ul>
            <li>Iterate <span class="math math-inline"><span class="katex"><span
                    class="katex-mathml">left\text{left}</span><span class="katex-html" aria-hidden="true"><span
                    class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord text"><span
                    class="mord">left</span></span></span></span></span></span> from <span
                    class="math math-inline"><span class="katex"><span class="katex-mathml">00</span><span
                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                   style="height: 0.6444em;"></span><span
                    class="mord">0</span></span></span></span></span> to <span class="math math-inline"><span
                    class="katex"><span class="katex-mathml">n−lengthn - \text{length}</span><span class="katex-html"
                                                                                                   aria-hidden="true"><span
                    class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
                    class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                    class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                    class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                    class="mord text"><span class="mord">length</span></span></span></span></span></span>.
                <ul>
                    <li>Set <span class="math math-inline"><span class="katex"><span class="katex-mathml">right=left+length−1\text{right} = \text{left} + \text{length} - 1</span><span
                            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                           style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                            class="mord text"><span class="mord">right</span></span><span class="mspace"
                                                                                          style="margin-right: 0.2778em;"></span><span
                            class="mrel">=</span><span class="mspace"
                                                       style="margin-right: 0.2778em;"></span></span><span class="base"><span
                            class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span
                            class="mord text"><span class="mord">left</span></span><span class="mspace"
                                                                                         style="margin-right: 0.2222em;"></span><span
                            class="mbin">+</span><span class="mspace"
                                                       style="margin-right: 0.2222em;"></span></span><span class="base"><span
                            class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                            class="mord text"><span class="mord">length</span></span><span class="mspace"
                                                                                           style="margin-right: 0.2222em;"></span><span
                            class="mbin">−</span><span class="mspace"
                                                       style="margin-right: 0.2222em;"></span></span><span class="base"><span
                            class="strut" style="height: 0.6444em;"></span><span
                            class="mord">1</span></span></span></span></span>.
                    </li>
                    <li>Set <span class="math math-inline"><span class="katex"><span
                            class="katex-mathml">j=−1j = -1</span><span class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
                            class="mrel">=</span><span class="mspace"
                                                       style="margin-right: 0.2778em;"></span></span><span class="base"><span
                            class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                            class="mord">−</span><span class="mord">1</span></span></span></span></span>. It will be the
                        leftmost index of the character differing from <code>s[right]</code>. <span
                                class="math math-inline"><span class="katex"><span
                                class="katex-mathml">j=−1j = -1</span><span class="katex-html" aria-hidden="true"><span
                                class="base"><span class="strut"
                                                   style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                                class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                                       style="margin-right: 0.2778em;"></span><span
                                class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                                class="base"><span class="strut"
                                                   style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                                class="mord">−</span><span class="mord">1</span></span></span></span></span> means we
                        have not found any such character yet.
                    </li>
                    <li>At this point we have fixed the state <code>(left, right)</code>. As discussed above, we now try
                        all values of <span class="math math-inline"><span class="katex"><span
                                class="katex-mathml">ii</span><span class="katex-html" aria-hidden="true"><span
                                class="base"><span class="strut" style="height: 0.6595em;"></span><span
                                class="mord mathnormal">i</span></span></span></span></span>. Iterate <span
                                class="math math-inline"><span class="katex"><span class="katex-mathml">ii</span><span
                                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                               style="height: 0.6595em;"></span><span
                                class="mord mathnormal">i</span></span></span></span></span> from <span
                                class="math math-inline"><span class="katex"><span
                                class="katex-mathml">left\text{left}</span><span class="katex-html"
                                                                                 aria-hidden="true"><span
                                class="base"><span class="strut" style="height: 0.6944em;"></span><span
                                class="mord text"><span class="mord">left</span></span></span></span></span></span> to
                        <span class="math math-inline"><span class="katex"><span class="katex-mathml">right−1\text{right} - 1</span><span
                                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                               style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                                class="mord text"><span class="mord">right</span></span><span class="mspace"
                                                                                              style="margin-right: 0.2222em;"></span><span
                                class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                                class="mord">1</span></span></span></span></span>.
                        <ul>
                            <li>If <code>s[i] != s[r]</code> (the character differs from <code>s[right]</code>) and
                                <span class="math math-inline"><span class="katex"><span
                                        class="katex-mathml">j=−1j = -1</span><span class="katex-html"
                                                                                    aria-hidden="true"><span
                                        class="base"><span class="strut"
                                                           style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                                        class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span
                                        class="mspace" style="margin-right: 0.2778em;"></span><span
                                        class="mrel">=</span><span class="mspace"
                                                                   style="margin-right: 0.2778em;"></span></span><span
                                        class="base"><span class="strut"
                                                           style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                                        class="mord">−</span><span class="mord">1</span></span></span></span></span>
                                (there was no differing character earlier), set <span class="math math-inline"><span
                                        class="katex"><span class="katex-mathml">j=ij = i</span><span class="katex-html"
                                                                                                      aria-hidden="true"><span
                                        class="base"><span class="strut"
                                                           style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                                        class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span
                                        class="mspace" style="margin-right: 0.2778em;"></span><span
                                        class="mrel">=</span><span class="mspace"
                                                                   style="margin-right: 0.2778em;"></span></span><span
                                        class="base"><span class="strut" style="height: 0.6595em;"></span><span
                                        class="mord mathnormal">i</span></span></span></span></span> (it is the first
                                such character).
                            </li>
                            <li>If <span class="math math-inline"><span class="katex"><span class="katex-mathml">j≠−1j \ne -1</span><span
                                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                                   style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                                    class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span
                                    class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span
                                    class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span
                                    class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                                    class="inner"><span class="mord"><span class="mrel"></span></span></span><span
                                    class="fix"></span></span></span></span></span><span
                                    class="mrel">=</span></span><span class="mspace"
                                                                      style="margin-right: 0.2778em;"></span></span><span
                                    class="base"><span class="strut"
                                                       style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                                    class="mord">−</span><span class="mord">1</span></span></span></span></span>, update
                                <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[left][right]\text{dp}[\text{left}][\text{right}]</span><span
                                        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
                                        class="mord text"><span class="mord">dp</span></span><span
                                        class="mopen">[</span><span class="mord text"><span
                                        class="mord">left</span></span><span class="mclose">]</span><span class="mopen">[</span><span
                                        class="mord text"><span class="mord">right</span></span><span
                                        class="mclose">]</span></span></span></span></span> with the value of <span
                                        class="math math-inline"><span class="katex"><span class="katex-mathml">1+dp[j][i]+dp[i+1][right]1 + \text{dp}[j][i] + \text{dp}[i + 1][\text{right}]</span><span
                                        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                                       style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                                        class="mord">1</span><span class="mspace"
                                                                   style="margin-right: 0.2222em;"></span><span
                                        class="mbin">+</span><span class="mspace"
                                                                   style="margin-right: 0.2222em;"></span></span><span
                                        class="base"><span class="strut"
                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
                                        class="mord text"><span class="mord">dp</span></span><span
                                        class="mopen">[</span><span class="mord mathnormal"
                                                                    style="margin-right: 0.05724em;">j</span><span
                                        class="mclose">]</span><span class="mopen">[</span><span
                                        class="mord mathnormal">i</span><span class="mclose">]</span><span
                                        class="mspace" style="margin-right: 0.2222em;"></span><span
                                        class="mbin">+</span><span class="mspace"
                                                                   style="margin-right: 0.2222em;"></span></span><span
                                        class="base"><span class="strut"
                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
                                        class="mord text"><span class="mord">dp</span></span><span
                                        class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace"
                                                                                                          style="margin-right: 0.2222em;"></span><span
                                        class="mbin">+</span><span class="mspace"
                                                                   style="margin-right: 0.2222em;"></span></span><span
                                        class="base"><span class="strut"
                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
                                        class="mord">1</span><span class="mclose">]</span><span
                                        class="mopen">[</span><span class="mord text"><span
                                        class="mord">right</span></span><span
                                        class="mclose">]</span></span></span></span></span>, if it is smaller.
                            </li>
                        </ul>
                    </li>
                    <li>If <span class="math math-inline"><span class="katex"><span
                            class="katex-mathml">j=−1j = -1</span><span class="katex-html" aria-hidden="true"><span
                            class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
                            class="mrel">=</span><span class="mspace"
                                                       style="margin-right: 0.2778em;"></span></span><span class="base"><span
                            class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                            class="mord">−</span><span class="mord">1</span></span></span></span></span> (the substring
                        <span class="math math-inline"><span class="katex"><span
                                class="katex-mathml">sl..rs_{l..r}</span><span class="katex-html"
                                                                               aria-hidden="true"><span
                                class="base"><span class="strut"
                                                   style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                                class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                                                     style="height: 0.3361em;"><span
                                style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                                    style="height: 2.7em;"></span><span
                                class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                                class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span
                                class="mord mtight">..</span><span class="mord mathnormal mtight"
                                                                   style="margin-right: 0.02778em;">r</span></span></span></span></span><span
                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                                           style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
                        consists of the same character), set <span class="math math-inline"><span class="katex"><span
                                class="katex-mathml">dp[left][right]=0\text{dp}[\text{left}][\text{right}] = 0</span><span
                                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                               style="height: 1em; vertical-align: -0.25em;"></span><span
                                class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                                class="mord text"><span class="mord">left</span></span><span
                                class="mclose">]</span><span class="mopen">[</span><span class="mord text"><span
                                class="mord">right</span></span><span class="mclose">]</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span><span
                                class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                                class="mord">0</span></span></span></span></span>. (The base case of the DP.)
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li>Return <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[0][n−1]+1\text{dp}[0][n - 1] + 1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord">0</span><span
            class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span
            class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace"
                                                                                                   style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord">1</span><span class="mclose">]</span><span class="mspace"
                                                                    style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>.
    </li>
</ol>
<h4 id="implementation">Implementation</h4>
<pre>
    Java
    <code>
        class Solution {
    public int strangePrinter(String s) {
        int n = s.length();
        int dp[][] = new int[n][n];
        for (int length = 1; length <= n; length++) {
            for (int left = 0; left <= n - length; left++) {
                int right = left + length - 1;
                int j = -1;
                dp[left][right] = n;
                for (int i = left; i < right; i++) {
                    if (s.charAt(i) != s.charAt(right) && j == -1) {
                        j = i;
                    }
                    if (j != -1) {
                        dp[left][right] = Math.min(dp[left][right], 1 + dp[j][i] + dp[i + 1][right]);
                    }
                }

                if (j == -1) {
                    dp[left][right] = 0;
                }

            }
        }

        return dp[0][n - 1] + 1;
    }
}
    </code>
    C++
    <code>
        class Solution {
public:
    int strangePrinter(string s) {
        int n = s.size();
        vector dp(n, vector<int>(n, n));
        for (int length = 1; length <= n; length++) {
            for (int left = 0; left <= n - length; left++) {
                int right = left + length - 1;
                int j = -1;
                for (int i = left; i < right; i++) {
                    if (s[i] != s[right] && j == -1) {
                        j = i;
                    }
                    if (j != -1) {
                        dp[left][right] = min(dp[left][right], 1 + dp[j][i] + dp[i + 1][right]);
                    }
                }

                if (j == -1) {
                    dp[left][right] = 0;
                }
            }
        }

        return dp[0][n - 1] + 1;
    }
};
    </code>
    Python3
    <code>
        class Solution:
    def strangePrinter(self, s: str) -> int:
        n = len(s)
        dp = [[n] * n for _ in range(n)]
        for length in range(1, n + 1):
            for left in range(n - length + 1):
                right = left + length - 1
                j = -1
                for i in range(left, right):
                    if s[i] != s[right] and j == -1:
                        j = i
                    if j != -1:
                        dp[left][right] = min(dp[left][right], 1 + dp[j][i] + dp[i + 1][right])

                if j == -1:
                    dp[left][right] = 0

        return dp[0][n - 1] + 1
    </code>
</pre>
<h4 id="complexity-analysis">Complexity Analysis</h4>
<ul>
    <li>Time complexity: <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">O(n3)O(n^3)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord mathnormal"
                                                                                          style="margin-right: 0.02778em;">O</span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mtight">3</span></span></span></span></span></span></span></span><span
            class="mclose">)</span></span></span></span></span>.
    </li>
</ul>
<p>There are three nested loops: <code>for length</code>, <code>for left</code>, <code>for i</code>. Since each of these
    loops performs <span class="math math-inline"><span class="katex"><span class="katex-mathml">O(n)O(n)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span
            class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> iterations, the
    total time complexity is <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">O(n3)O(n^3)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord mathnormal"
                                                                                          style="margin-right: 0.02778em;">O</span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mtight">3</span></span></span></span></span></span></span></span><span
            class="mclose">)</span></span></span></span></span>.</p>
<ul>
    <li>Space complexity: <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">O(n2)O(n^2)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord mathnormal"
                                                                                          style="margin-right: 0.02778em;">O</span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mtight">2</span></span></span></span></span></span></span></span><span
            class="mclose">)</span></span></span></span></span>.
    </li>
</ul>
<p>We maintain a 2D array <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">dp\text{dp}</span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord text"><span
        class="mord">dp</span></span></span></span></span></span> of size <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">n×nn \times n</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
        class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 0.4306em;"></span><span
        class="mord mathnormal">n</span></span></span></span></span>.</p>
<hr>
<h3 id="approach-2-top-down-dynamic-programming-memoization">Approach 2: Top-Down Dynamic Programming (Memoization)</h3>
<h4 id="intuition-1">Intuition</h4>
<p>In this approach, we will calculate the same DP as in the previous one, but the manner of organizing computations
    will differ.</p>
<p>We will use the recursive function <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(l,r)\text{solve}(l, r)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span> that returns the value of <span
        class="math math-inline"><span class="katex"><span class="katex-mathml">dp[l][r]\text{dp}[l][r]</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord mathnormal"
                                                                                               style="margin-right: 0.01968em;">l</span><span
        class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal"
                                                                 style="margin-right: 0.02778em;">r</span><span
        class="mclose">]</span></span></span></span></span>.</p>
<p>One can rewrite the DP recurrence relation in terms of <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">solve\text{solve}</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord text"><span class="mord">solve</span></span></span></span></span></span>
    as follows. If the substring <span class="math math-inline"><span class="katex"><span class="katex-mathml">sl..rs_{l..r}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.5806em; vertical-align: -0.15em;"></span><span
            class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
            style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mord mtight">..</span><span class="mord mathnormal mtight" style="margin-right: 0.02778em;">r</span></span></span></span></span><span
            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                       style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
    consists of the same character, <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(l,r)\text{solve}(l, r)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.02778em;">r</span><span
            class="mclose">)</span></span></span></span></span> returns zero (the base case of the DP). Otherwise, it
    returns the minimum of <span class="math math-inline"><span class="katex"><span class="katex-mathml">1+fsolve(j,i)+solve(i+1,r)1 + f\text{solve}(j, i) + \text{solve}(i + 1, r)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span
            class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut"
                                                                                                  style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord mathnormal" style="margin-right: 0.10764em;">f</span><span class="mord text"><span class="mord">solve</span></span><span
            class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace"
                                                                               style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
            class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
            class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord">1</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span>
    over all <span class="math math-inline"><span class="katex"><span class="katex-mathml">j≤i&lt;rj \le i &lt; r</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.854em; vertical-align: -0.1944em;"></span><span
            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">≤</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6986em; vertical-align: -0.0391em;"></span><span
            class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal"
                                                                                    style="margin-right: 0.02778em;">r</span></span></span></span></span>.
</p>
<p>The answer to the problem is <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(0,n−1)+1=dp[0][n−1]+1\text{solve}(0, n - 1) + 1 = \text{dp}[0][n - 1] + 1</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
        class="mord">0</span><span class="mpunct">,</span><span class="mspace"
                                                                style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span
        class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 0.6444em;"></span><span class="mord">1</span><span class="mspace"
                                                                                        style="margin-right: 0.2778em;"></span><span
        class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span
        class="mord">dp</span></span><span class="mopen">[</span><span class="mord">0</span><span
        class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mspace"
                                                                                                       style="margin-right: 0.2222em;"></span><span
        class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span
        class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>.</p>
<p>The issue here is that <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve\text{solve}</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.6944em;"></span><span
        class="mord text"><span class="mord">solve</span></span></span></span></span></span> might be called
    (exponentially) many times for the same pair of parameters <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">(l,r)(l, r)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.02778em;">r</span><span
            class="mclose">)</span></span></span></span></span>.</p>
<p>Each time we call, for instance, <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(4,7)\text{solve}(4, 7)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
        class="mord">4</span><span class="mpunct">,</span><span class="mspace"
                                                                style="margin-right: 0.1667em;"></span><span
        class="mord">7</span><span class="mclose">)</span></span></span></span></span>, we recompute the same result for
    <span class="math math-inline"><span class="katex"><span class="katex-mathml">l=4,r=7l = 4, r = 7</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.6944em;"></span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.8389em; vertical-align: -0.1944em;"></span><span
            class="mord">4</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">7</span></span></span></span></span>.
</p>
<p>Instead, one may keep the calculated values of <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">solve(l,r)\text{solve}(l, r)</span><span class="katex-html" aria-hidden="true"><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span> in memory. We will store the same DP table as in the
    previous approach. In this case, the process will be as follows.</p>
<p>For example, we call <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(4,7)\text{solve}(4, 7)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
        class="mord">4</span><span class="mpunct">,</span><span class="mspace"
                                                                style="margin-right: 0.1667em;"></span><span
        class="mord">7</span><span class="mclose">)</span></span></span></span></span> for the first time, calculate the
    result for <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">l=4,r=7l = 4, r = 7</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal"
                                                                                    style="margin-right: 0.01968em;">l</span><span
            class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.8389em; vertical-align: -0.1944em;"></span><span
            class="mord">4</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">7</span></span></span></span></span>,
    and write this result into <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[4][7]\text{dp}[4][7]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord">4</span><span
            class="mclose">]</span><span class="mopen">[</span><span class="mord">7</span><span class="mclose">]</span></span></span></span></span>.
    When we call <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(4,7)\text{solve}(4, 7)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
            class="mord">4</span><span class="mpunct">,</span><span class="mspace"
                                                                    style="margin-right: 0.1667em;"></span><span
            class="mord">7</span><span class="mclose">)</span></span></span></span></span> for the second time, we
    immediately return <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[4][7]\text{dp}[4][7]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span class="mord">4</span><span
            class="mclose">]</span><span class="mopen">[</span><span class="mord">7</span><span class="mclose">]</span></span></span></span></span>.
</p>
<p>In this way, we calculate the value of <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve\text{solve}</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 0.6944em;"></span><span
        class="mord text"><span class="mord">solve</span></span></span></span></span></span> for each state (each pair
    of parameters <span class="math math-inline"><span class="katex"><span class="katex-mathml">(l,r)(l, r)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span
            class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mclose">)</span></span></span></span></span>)
    only once.</p>
<p>There remains one small technical question: how to know whether we call <span class="math math-inline"><span
        class="katex"><span class="katex-mathml">solve(l,r)\text{solve}(l, r)</span><span class="katex-html"
                                                                                          aria-hidden="true"><span
        class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
        class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
        class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                    style="margin-right: 0.02778em;">r</span><span
        class="mclose">)</span></span></span></span></span> for the first time and need to compute the result, or we
    call it later and can return <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[l][r]\text{dp}[l][r]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
            class="mclose">]</span></span></span></span></span> found earlier? One can handle this by initializing the
    <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp\text{dp}</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="mord text"><span class="mord">dp</span></span></span></span></span></span> array with the value of
    <span class="math math-inline"><span class="katex"><span class="katex-mathml">−1-1</span><span class="katex-html"
                                                                                                   aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">−</span><span class="mord">1</span></span></span></span></span>. Then <span
            class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp[l][r]=−1\text{dp}[l][r] = -1</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
            class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">−</span><span class="mord">1</span></span></span></span></span> will mean that we have not
    calculated <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(l,r)\text{solve}(l, r)</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.02778em;">r</span><span
            class="mclose">)</span></span></span></span></span> yet. As soon as we find the result of <span
            class="math math-inline"><span class="katex"><span
            class="katex-mathml">solve(l,r)\text{solve}(l, r)</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mpunct">,</span><span
            class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal"
                                                                        style="margin-right: 0.02778em;">r</span><span
            class="mclose">)</span></span></span></span></span>, we will write it into <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">dp[l][r]\text{dp}[l][r]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span
            class="mclose">]</span></span></span></span></span>, and this value will not be <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">−1-1</span><span class="katex-html"
                                                                                                     aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">−</span><span class="mord">1</span></span></span></span></span> anymore.</p>
<h4 id="algorithm-1">Algorithm</h4>
<blockquote>
    <p>In the code, we use <code>left</code> for <code>l</code> and <code>right</code> for <code>r</code> for clarity.
    </p>
</blockquote>
<p>The function <code>solve</code> takes parameters <code>left</code> and <code>right</code>.</p>
<ol>
    <li>If <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[left][right]≠−1\text{dp}[\text{left}][\text{right}] \ne -1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
            class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span
            class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut"
                                                                                                style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
            class="inner"><span class="mord"><span class="mrel"></span></span></span><span
            class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"
                                                                                                   style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">−</span><span class="mord">1</span></span></span></span></span>, return <span
            class="math math-inline"><span class="katex"><span class="katex-mathml">dp[left][right]\text{dp}[\text{left}][\text{right}]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
            class="mclose">]</span></span></span></span></span>.
    </li>
    <li>Set <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[left][right]=n\text{dp}[\text{left}][\text{right}] = n</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
            class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.4306em;"></span><span
            class="mord mathnormal">n</span></span></span></span></span>. Since we will find the minimum, we initialize
        it with a large value.
    </li>
    <li>Set <span class="math math-inline"><span class="katex"><span class="katex-mathml">j=−1j = -1</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.854em; vertical-align: -0.1944em;"></span><span
            class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                   style="margin-right: 0.2778em;"></span><span
            class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
            class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
            class="mord">−</span><span class="mord">1</span></span></span></span></span>. It will be the leftmost index
        of the character differing from <code>s[right]</code>. <span class="math math-inline"><span class="katex"><span
                class="katex-mathml">j=−1j = -1</span><span class="katex-html" aria-hidden="true"><span
                class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                       style="margin-right: 0.2778em;"></span><span
                class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                class="mord">−</span><span class="mord">1</span></span></span></span></span> means we have not found any
        such character yet.
    </li>
    <li>Iterate <span class="math math-inline"><span class="katex"><span class="katex-mathml">ii</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 0.6595em;"></span><span
            class="mord mathnormal">i</span></span></span></span></span> from <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">ll</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal"
                                                                                    style="margin-right: 0.01968em;">l</span></span></span></span></span>
        to <span class="math math-inline"><span class="katex"><span class="katex-mathml">r−1r - 1</span><span
                class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                               style="height: 0.6667em; vertical-align: -0.0833em;"></span><span
                class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mspace"
                                                                                       style="margin-right: 0.2222em;"></span><span
                class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                class="base"><span class="strut" style="height: 0.6444em;"></span><span
                class="mord">1</span></span></span></span></span>.
        <ul>
            <li>If <code>s[i] != s[r]</code> (the character differs from <code>s[right]</code>) and <span
                    class="math math-inline"><span class="katex"><span class="katex-mathml">j=−1j = -1</span><span
                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                   style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                    class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                           style="margin-right: 0.2778em;"></span><span
                    class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                    class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                    class="mord">−</span><span class="mord">1</span></span></span></span></span> (there was no differing
                character earlier), set <span class="math math-inline"><span class="katex"><span class="katex-mathml">j=ij = i</span><span
                        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                       style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                        class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                               style="margin-right: 0.2778em;"></span><span
                        class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                        class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span>
                (it is the first such character).
            </li>
            <li>If <span class="math math-inline"><span class="katex"><span
                    class="katex-mathml">j≠−1j \ne -1</span><span class="katex-html" aria-hidden="true"><span
                    class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                    class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                           style="margin-right: 0.2778em;"></span><span
                    class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span
                    class="rlap"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span
                    class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span
                    class="mrel">=</span></span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                    class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                    class="mord">−</span><span class="mord">1</span></span></span></span></span>, update <span
                    class="math math-inline"><span class="katex"><span class="katex-mathml">dp[left][right]\text{dp}[\text{left}][\text{right}]</span><span
                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                   style="height: 1em; vertical-align: -0.25em;"></span><span
                    class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                    class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
                    class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
                    class="mclose">]</span></span></span></span></span> with the value of <span
                    class="math math-inline"><span class="katex"><span class="katex-mathml">1+solve(j,i)+solve(i+1,right)1 + \text{solve}(j, i) + \text{solve}(i + 1, \text{right})</span><span
                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                   style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                    class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span
                    class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut"
                                                                                                          style="height: 1em; vertical-align: -0.25em;"></span><span
                    class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
                    class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mpunct">,</span><span
                    class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">i</span><span
                    class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                    class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                    class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                    class="mord text"><span class="mord">solve</span></span><span class="mopen">(</span><span
                    class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
                    class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span
                    class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
                    class="mord">1</span><span class="mpunct">,</span><span class="mspace"
                                                                            style="margin-right: 0.1667em;"></span><span
                    class="mord text"><span class="mord">right</span></span><span class="mclose">)</span></span></span></span></span>,
                if it is smaller.
            </li>
            <li>If <span class="math math-inline"><span class="katex"><span class="katex-mathml">j=−1j = -1</span><span
                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                   style="height: 0.854em; vertical-align: -0.1944em;"></span><span
                    class="mord mathnormal" style="margin-right: 0.05724em;">j</span><span class="mspace"
                                                                                           style="margin-right: 0.2778em;"></span><span
                    class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                    class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span
                    class="mord">−</span><span class="mord">1</span></span></span></span></span> (the substring <span
                    class="math math-inline"><span class="katex"><span class="katex-mathml">sl..rs_{l..r}</span><span
                    class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                   style="height: 0.5806em; vertical-align: -0.15em;"></span><span
                    class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span
                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span
                    style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut"
                                                                                        style="height: 2.7em;"></span><span
                    class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span
                    class="mord mathnormal mtight" style="margin-right: 0.01968em;">l</span><span
                    class="mord mtight">..</span><span class="mord mathnormal mtight"
                                                       style="margin-right: 0.02778em;">r</span></span></span></span></span><span
                    class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                                               style="height: 0.15em;"><span></span></span></span></span></span></span></span></span></span></span>
                consists of the same character), set <span class="math math-inline"><span class="katex"><span
                        class="katex-mathml">dp[left][right]=0\text{dp}[\text{left}][\text{right}] = 0</span><span
                        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
                        class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
                        class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
                        class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
                        class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span
                        class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span
                        class="base"><span class="strut" style="height: 0.6444em;"></span><span
                        class="mord">0</span></span></span></span></span>. (The base case of the DP.)
            </li>
        </ul>
    </li>
    <li>Return <span class="math math-inline"><span class="katex"><span class="katex-mathml">dp[left][right]\text{dp}[\text{left}][\text{right}]</span><span
            class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                           style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
            class="mclose">]</span></span></span></span></span>.
    </li>
</ol>
<p>One has to declare the DP table of size <span class="math math-inline"><span class="katex"><span
        class="katex-mathml">n×nn \times n</span><span class="katex-html" aria-hidden="true"><span class="base"><span
        class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">n</span><span
        class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace"
                                                                                               style="margin-right: 0.2222em;"></span></span><span
        class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>
    and initialize it with <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">−1-1</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">−</span><span
            class="mord">1</span></span></span></span></span> before calling <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">solve\text{solve}</span><span class="katex-html"
                                                                                   aria-hidden="true"><span
            class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord text"><span
            class="mord">solve</span></span></span></span></span></span>.</p>
<p>The answer to the problem is <span class="math math-inline"><span class="katex"><span class="katex-mathml">solve(0,n−1)+1solve(0, n - 1) + 1</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1em; vertical-align: -0.25em;"></span><span
        class="mord mathnormal">so</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span
        class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">e</span><span
        class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace"
                                                                                            style="margin-right: 0.1667em;"></span><span
        class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span
        class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span
        class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span
        class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>.</p>
<h4 id="implementation-1">Implementation</h4>
<pre>
    Java
    <code>
        class Solution {
    int dp[][];

    private int solve(String s, int n, int left, int right) {
        if (dp[left][right] != -1) {
            return dp[left][right];
        }

        dp[left][right] = n;
        int j = -1;
        for (int i = left; i < right; i++) {
            if (s.charAt(i) != s.charAt(right) && j == -1) {
                j = i;
            }

            if (j != -1) {
                dp[left][right] = Math.min(dp[left][right], 1 + solve(s, n, j, i) + solve(s, n, i + 1, right));
            }
        }

        if (j == -1) {
            dp[left][right] = 0;
        }

        return dp[left][right];
    }

    public int strangePrinter(String s) {
        int n = s.length();
        dp = new int[n][n];
        for (int left = 0; left < n; left++) {
            for (int right = 0; right < n; right++) {
                dp[left][right] = -1;
            }
        }

        return solve(s, n, 0, n - 1) + 1;
    }
}
    </code>
    C++
    <code>
        class Solution {
public:
    int strangePrinter(string s) {
        int n = s.size();
        vector dp(n, vector<int>(n, -1));

        function<int(int, int)> solve = [&](int left, int right) -> int {
            if (dp[left][right] != -1) {
                return dp[left][right];
            }

            dp[left][right] = n;
            int j = -1;

            for (int i = left; i < right; i++) {
                if (s[i] != s[right] && j == -1) {
                    j = i;
                }

                if (j != -1) {
                    dp[left][right] = min(dp[left][right], 1 + solve(j, i) + solve(i + 1, right));
                }
            }

            if (j == -1) {
                dp[left][right] = 0;
            }

            return dp[left][right];
        };

        return solve(0, n - 1) + 1;
    }
};
    </code>
    Python3
    <code>
        class Solution:
    def strangePrinter(self, s: str) -> int:
        n = len(s)
        dp = [[-1] * n for _ in range(n)]

        def solve(left, right):
            if dp[left][right] != -1:
                return dp[left][right]

            dp[left][right] = n
            j = -1

            for i in range(left, right):
                if s[i] != s[right] and j == -1:
                    j = i
                if j != -1:
                    dp[left][right] = min(dp[left][right], 1 + solve(j, i) + solve(i + 1, right))

            if j == -1:
                dp[left][right] = 0

            return dp[left][right]

        return solve(0, n - 1) + 1
    </code>
</pre>
<h4 id="complexity-analysis-1">Complexity Analysis</h4>
<ul>
    <li>Time complexity: <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">O(n3)O(n^3)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord mathnormal"
                                                                                          style="margin-right: 0.02778em;">O</span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mtight">3</span></span></span></span></span></span></span></span><span
            class="mclose">)</span></span></span></span></span>.
    </li>
</ul>
<p>Even though we changed the order of calculating DP, the time complexity is the same as in the previous approach: for
    each <code>left, right</code>, we compute <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp[left][right]\text{dp}[\text{left}][\text{right}]</span><span class="katex-html"
                                                                                                 aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
            class="mclose">]</span></span></span></span></span> in <span class="math math-inline"><span
            class="katex"><span class="katex-mathml">O(n)O(n)</span><span class="katex-html" aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord mathnormal" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span
            class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>. Since we store
    the results in memory, we will calculate each <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">dp[left][right]\text{dp}[\text{left}][\text{right}]</span><span class="katex-html"
                                                                                                 aria-hidden="true"><span
            class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span
            class="mord text"><span class="mord">dp</span></span><span class="mopen">[</span><span
            class="mord text"><span class="mord">left</span></span><span class="mclose">]</span><span
            class="mopen">[</span><span class="mord text"><span class="mord">right</span></span><span
            class="mclose">]</span></span></span></span></span> only once.</p>
<ul>
    <li>Space complexity: <span class="math math-inline"><span class="katex"><span
            class="katex-mathml">O(n2)O(n^2)</span><span class="katex-html" aria-hidden="true"><span class="base"><span
            class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord mathnormal"
                                                                                          style="margin-right: 0.02778em;">O</span><span
            class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span
            class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span
            style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span
            class="sizing reset-size6 size3 mtight"><span
            class="mord mtight">2</span></span></span></span></span></span></span></span><span
            class="mclose">)</span></span></span></span></span>.
    </li>
</ul>
<p>It is the same as in the first approach. The <code>dp</code> array we are using to cache results takes <span
        class="math math-inline"><span class="katex"><span class="katex-mathml">O(n2)O(n^2)</span><span
        class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                                                                       style="height: 1.0641em; vertical-align: -0.25em;"></span><span
        class="mord mathnormal" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span
        class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span
        class="vlist" style="height: 0.8141em;"><span style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut"
                                                                                                         style="height: 2.7em;"></span><span
        class="sizing reset-size6 size3 mtight"><span
        class="mord mtight">2</span></span></span></span></span></span></span></span><span
        class="mclose">)</span></span></span></span></span> space. We also use some stack space for the recursion, but
    it is dominated by <code>dp</code>.</p>
</body>
</html>